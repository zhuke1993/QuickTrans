# TTS功能测试指南

## 测试前准备

1. **加载扩展**
   - 打开Chrome浏览器
   - 访问 `chrome://extensions/`
   - 启用"开发者模式"
   - 点击"加载已解压的扩展程序"
   - 选择QuickTrans项目目录

2. **配置API**
   - 点击扩展图标或访问扩展的选项页面
   - 添加一个通义千问TTS配置
   - 填写API端点、密钥和模型信息
   - 选择TTS模型（如 qwen3-tts-flash）
   - 选择音色（如 Cherry）
   - 保存配置

## 功能测试清单

### 1. UI显示测试

- [ ] 在任意网页选中一个英文单词（如"hello"）
- [ ] 验证词典弹窗正确显示
- [ ] 验证单词右侧显示发音按钮（🔊图标）
- [ ] 如果有上下文，验证上下文区域右上角显示发音按钮

### 2. 单词发音测试

- [ ] 选中单词"hello"
- [ ] 点击单词右侧的发音按钮
- [ ] 验证按钮变为加载状态（⏳图标）
- [ ] 验证音频成功合成后按钮变为播放状态（⏸️图标）
- [ ] 验证能听到单词的发音
- [ ] 验证播放完成后按钮恢复默认状态（🔊图标）

### 3. 句子发音测试

- [ ] 选中一个英文单词，确保该单词在完整句子中
- [ ] 验证上下文区域显示句子
- [ ] 点击上下文区域右上角的发音按钮
- [ ] 验证按钮状态变化（加载→播放→默认）
- [ ] 验证能听到整个句子的发音

### 4. 播放控制测试

- [ ] 点击发音按钮开始播放
- [ ] 在播放过程中再次点击同一按钮
- [ ] 验证音频停止播放
- [ ] 验证按钮恢复默认状态

### 5. 多次播放测试

- [ ] 连续多次点击发音按钮
- [ ] 验证每次都能正确播放
- [ ] 验证不会出现音频重叠

### 6. 弹窗关闭测试

- [ ] 开始播放音频
- [ ] 在播放过程中关闭词典弹窗
- [ ] 验证音频自动停止

### 7. 错误处理测试

#### 未配置API
- [ ] 删除所有API配置
- [ ] 选中单词并点击发音按钮
- [ ] 验证显示"未配置API"错误提示

#### TTS功能禁用
- [ ] 删除所有TTS配置
- [ ] 选中单词并点击发音按钮
- [ ] 验证显示“未配置TTS API”错误提示

#### API不支持TTS
- [ ] 配置一个错误的API端点
- [ ] 选中单词并点击发音按钮
- [ ] 验证显示错误提示

#### 网络错误
- [ ] 断开网络连接
- [ ] 选中单词并点击发音按钮
- [ ] 验证显示超时或网络错误提示

### 8. 配置测试

- [ ] 在设置页面修改TTS模型名称
- [ ] 验证新配置生效
- [ ] 在设置页面修改音色
- [ ] 验证音色变化（播放音频听音色差异）
- [ ] 修改音频格式
- [ ] 验证仍能正常播放

### 9. 性能测试

- [ ] 选中复杂的长单词
- [ ] 验证TTS请求在30秒内完成
- [ ] 选中长句子（50+字符）
- [ ] 验证能正常合成并播放

### 10. 兼容性测试

- [ ] 在不同网站测试功能（如Wikipedia、GitHub、新闻网站）
- [ ] 验证在所有网站都能正常工作
- [ ] 测试特殊字符和标点符号
- [ ] 验证能正确处理

## 常见问题排查

### 发音按钮不显示
1. 检查是否为词典模式（只选中单个单词）
2. 检查CSS是否正确加载
3. 检查控制台是否有错误

### 点击按钮无反应
1. 检查API配置是否正确
2. 检查网络连接
3. 打开开发者工具查看控制台错误信息
4. 检查background.js中的TTS服务是否正常

### 音频无法播放
1. 检查浏览器音频权限
2. 检查返回的音频数据格式
3. 检查Base64转Blob的转换是否正确
4. 尝试不同的音频格式（mp3/opus/aac）

### 音频质量问题
1. 尝试使用qwen3-tts-lite模型（更高质量）
2. 更换不同音色（Cherry, Olivia, Luna, Daniel等）
3. 检查通义千问TTS服务质量

## 成功标准

所有测试项目通过，包括：
- ✅ UI正确显示发音按钮
- ✅ 单词和句子都能正确发音
- ✅ 播放控制功能正常
- ✅ 错误处理友好
- ✅ 配置功能完整
- ✅ 性能符合预期
- ✅ 兼容性良好
